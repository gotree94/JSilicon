

## ðŸ§  1. íŒŒì´í”„ë¼ì¸ì´ ì—†ëŠ” CPU(Non-Pipelined / Single-Cycle / Multi-Cycle)ì˜ íŠ¹ì§•
### ðŸŸ¦ 1-1. Single-Cycle CPU
* í•œ ëª…ë ¹ì–´ë¥¼ 1 í´ëŸ­ ì•ˆì—ì„œ Fetch â†’ Decode â†’ Execute â†’ Write-Backê¹Œì§€ ëª¨ë‘ ì²˜ë¦¬í•¨
* ALU, ë©”ëª¨ë¦¬, ë ˆì§€ìŠ¤í„° íŒŒì¼ ë“± ëª¨ë“  í•˜ë“œì›¨ì–´ë¥¼ 1 ì‹¸ì´í´ ì•ˆì— ë‹¤ í†µê³¼í•´ì•¼ í•¨
### âœ” ìž¥ì 
* êµ¬ì¡°ê°€ ë‹¨ìˆœí•¨
* êµ¬í˜„ ë‚œì´ë„ ë‚®ìŒ
* ë””ë²„ê¹… ì‰¬ì›€
## âœ˜ ë‹¨ì 
* í´ëŸ­ ì†ë„ë¥¼ ë§¤ìš° ë‚®ê²Œ ìž¡ì•„ì•¼ í•¨
* ì–´ë–¤ ëª…ë ¹ì–´ë“  ê°€ìž¥ ëŠë¦° ëª…ë ¹ì–´ì˜ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ í´ëŸ­ì„ ë§žì¶°ì•¼ í•¨
* UART ê°™ì€ ì£¼ë³€ìž¥ì¹˜ì™€ ë™ê¸°í™”ê°€ ë§¤ìš° ì–´ë ¤ì›€ (ë„ˆë¬´ ì§§ì€ ì‹œê°„ì— ëª¨ë“  ê²Œ ì´ë£¨ì–´ì ¸ì„œ)

### ðŸŸ¦ 1-2. Non-Pipelined Multi-Cycle CPU
* ëª…ë ¹ì–´ í•˜ë‚˜ë¥¼ ì—¬ëŸ¬ í´ëŸ­ì— ë‚˜ëˆ  ì²˜ë¦¬í•˜ì§€ë§Œ, í•œë²ˆì— í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë§Œ ì²˜ë¦¬
* ì¼ë°˜ì ì¸ ë‹¨ê³„:
  * FETCH
  * DECODE
  * EXECUTE
  * MEMORY (optional)
  * WRITE-BACK
* âœ” ìž¥ì 
  * íšŒë¡œê°€ single-cycleë³´ë‹¤ í›¨ì”¬ ìž‘ìŒ
  * í´ëŸ­ ì£¼ê¸°ë¥¼ ë” ì§§ê²Œ ìž¡ì„ ìˆ˜ ìžˆìŒ (ê° ë‹¨ê³„ëŠ” ê°€ë²¼ì›€)
  * ì œì–´ ë…¼ë¦¬ ì„¤ê³„ê°€ ê°„ë‹¨
* âœ˜ ë‹¨ì 
  * ì„±ëŠ¥ì€ íŒŒì´í”„ë¼ì¸ CPUë³´ë‹¤ ë‚®ìŒ (ëª…ë ¹ì–´ 1ê°œ = ì—¬ëŸ¬ í´ëŸ­)
  * ì™¸ë¶€ ìž¥ì¹˜ì™€ íƒ€ì´ë°ì„ ë§žì¶”ë ¤ë©´ FSM ì œì–´ê°€ í•„ìš”í•¨ â†’ UART íŠ¸ë¦¬ê±°, ALU ê²°ê³¼ sync ë“±

## ðŸš€ 2. íŒŒì´í”„ë¼ì¸ì´ ìžˆëŠ” CPU(Pipelined CPU)ì˜ íŠ¹ì§•
* ê°€ìž¥ ë„ë¦¬ ì•Œë ¤ì§„ êµ¬ì¡°ê°€ 5-stage pipeline:

| ë‹¨ê³„	| ì„¤ëª…|
|:--:|:--:| 
| IF	| instruction fetch| 
| ID	| instruction decode| 
| EX	| execute (ALU)| 
| MEM	| memory access| 
| WB	| write-back| 

* ê° ëª…ë ¹ì–´ëŠ” ê° ë‹¨ê³„ì—ì„œ â€œíë¦„ì²˜ëŸ¼â€ ì§„í–‰ë¨.
ë§ˆì¹˜ ê³µìž¥ì—ì„œ ë¬¼ê±´ì„ ì°ì–´ë‚´ë“¯ì´,
ì—¬ëŸ¬ ëª…ë ¹ì–´ê°€ ë™ì‹œì— ì„œë¡œ ë‹¤ë¥¸ ë‹¨ê³„ì—ì„œ ì‹¤í–‰ë¨.

ì˜ˆ:
1ë²ˆì§¸ ëª…ë ¹: EX ë‹¨ê³„
2ë²ˆì§¸ ëª…ë ¹: ID ë‹¨ê³„
3ë²ˆì§¸ ëª…ë ¹: IF ë‹¨ê³„

* âœ” ìž¥ì 
  * ì„±ëŠ¥ì´ ë¹„ì•½ì ìœ¼ë¡œ ìƒìŠ¹ (ê±°ì˜ 1í´ëŸ­ì— 1ëª…ë ¹ ì²˜ë¦¬)
  * í´ëŸ­ ì£¼ê¸°ë¥¼ ë§¤ìš° ì§§ê²Œ ìž¡ì„ ìˆ˜ ìžˆìŒ
  * ALU, ë©”ëª¨ë¦¬, ë ˆì§€ìŠ¤í„° íŒŒì¼ ë“±ì´ ë§¤ ì‚¬ì´í´ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©ë¨

* âœ˜ ë‹¨ì 
  * ë°ì´í„° í•´ì €ë“œ, ì œì–´ í•´ì €ë“œ ë“± ë¬¸ì œê°€ ìƒê¹€
  * forwarding, stall, flush ê°™ì€ ë³µìž¡í•œ ì œì–´ê°€ í•„ìš”
  * ì„¤ê³„/ë””ë²„ê¹… ë‚œì´ë„ê°€ ë§¤ìš° ë†’ìŒ
  * UART ê°™ì€ ì™¸ë¶€ slow ìž¥ì¹˜ì™€ ë™ê¸°í™”ê°€ ë‚œí•´í•´ì§

## ðŸ› 3. êµ¬ì¡°ì ìœ¼ë¡œ ì–´ë–¤ ì°¨ì´ê°€ ë°œìƒí•˜ëŠ”ê°€?
  * ðŸ”¸ Non-Pipelined CPU
  * cycle 1: fetch
  * cycle 2: decode
  * cycle 3: execute
  * cycle 4: write-back
  * cycle 5: uart-send

* ëª¨ë“  ë‹¨ê³„ëŠ” ì„œë¡œ ì‹œê°„ì ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ ìžˆì–´ì„œ:
* ì–¸ì œ ê°’ì´ í™•ì •ë˜ëŠ”ì§€ ëª…í™•
* UARTëŠ” â€œexecute ë‹¤ìŒ cycleì— wb ê°’ì´ í™•ì •ë¨â€ì²˜ëŸ¼ íƒ€ì´ë° ì„¤ê³„ê°€ ì‰¬ì›€
* ALUì™€ UARTê°€ ì‹¸ìš°ì§€ë„ ì•ŠìŒ

## ðŸ‘‰ TinyTapeout / Micro FPGA í”„ë¡œì íŠ¸ì—” ì´ êµ¬ì¡°ê°€ ì í•©

*ðŸ”¸ Pipelined CPU
* cycle 1:   IF1 - - - -
* cycle 2:   IF2 ID1 - - -
* cycle 3:   IF3 ID2 EX1 - -
* cycle 4:   IF4 ID3 EX2 MEM1 -
* cycle 5:   IF5 ID4 EX3 MEM2 WB1


fetch/decode/execute/write-backì´ ê²¹ì³ì„œ ì‹¤í–‰ë¨

ê° ë‹¨ê³„ëŠ” ê±°ì˜ ë§¤ cycle ê°€ë™ë¨

ê°‘ìžê¸° â€œoperandê°€ ì•„ì§ ì¤€ë¹„ ì•ˆ ë¨â€ ê°™ì€ ìƒí™©ì´ ìƒê¹€

ðŸ‘‰ UARTì²˜ëŸ¼ ëŠë¦° ìž¥ì¹˜ ì—°ê²° ì‹œ ë§¤ìš° ë¹„íš¨ìœ¨ì ì´ê³  ë³µìž¡í•´ì§

ðŸ”Ž 4. ì™œ ì§€ê¸ˆ ì„¤ê³„ëŠ” ë¹„ì •ìƒì ì´ì—ˆë‚˜?

í˜„ìž¬ ìƒí™©ì€ íŒŒì´í”„ë¼ì¸ì´ ì—†ëŠ” CPUì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì‹¤ì œ ë™ìž‘ì€ ì•„ëž˜ì²˜ëŸ¼ â€œë’¤ì„žì¸ íŒŒì´í”„ë¼ì¸â€ í˜•íƒœ:

PCëŠ” ê³„ì† ì¦ê°€ (fetch)

DECODERëŠ” ë§¤ cycle decode

REGëŠ” ì¡°ê±´ì— ë”°ë¼ ë§¤ cycle write

ì˜¤í¼ëžœë“œëŠ” ë ˆì§€ìŠ¤í„°ì— ì €ìž¥ë˜ì§€ ì•ŠìŒ

ALUëŠ” ena=1ì¼ ë•Œ ì•„ë¬´ ë•Œë‚˜ ê³„ì‚°

FSMì€ ena level=1ì´ë©´ ë°˜ë³µì ìœ¼ë¡œ UART ì „ì†¡

â†’ ê° ë‹¨ê³„ê°€ ë…ë¦½ë˜ì–´ ìžˆì§€ ì•Šê³ , ê²½ê³„ë„ ì—†ìŒ

ì¦‰,

ë‚´ë¶€ì ìœ¼ë¡œ í˜¼í•©í˜• íŒŒì´í”„ë¼ì¸ì˜ â€œë¶€ìž‘ìš©â€ì€ ë‹¤ ê°€ì§€ê³  ìžˆëŠ”ë°,
ì •ìž‘ íŒŒì´í”„ë¼ì¸ì´ ê°€ì§„ â€œìž¥ì â€ì€ í•˜ë‚˜ë„ ì—†ëŠ” ìƒí™©.

íŒŒì´í”„ë¼ì¸ì˜ ì¢‹ì€ ì (ë†’ì€ ì„±ëŠ¥)ì€ í™œìš©í•˜ì§€ ëª»í•˜ê³ ,
íŒŒì´í”„ë¼ì¸ì˜ ë‚˜ìœ ì (íƒ€ì´ë° ê¼¬ìž„)ë§Œ ì „ë¶€ ë‚˜íƒ€ë‚œ ê²ƒ.

ê·¸ëž˜ì„œ operandê°€ ALUì— ì•ˆ ë“¤ì–´ê°€ëŠ” ë¬¸ì œ,
UARTê°€ ì—°ì‚° íƒ€ì´ë°ì„ ë”°ë¼ê°€ì§€ ëª»í•˜ëŠ” ë¬¸ì œ,
manualê³¼ cpu ëª¨ë“œê°€ ì¶©ëŒí•˜ëŠ” ë¬¸ì œê°€ ëª¨ë‘ ë°œìƒí•œ ê²ƒ.

â­ 5. ì¼ë°˜ì ì¸ êµ¬ì¡°ëŠ” ì´ë ‡ê²Œ ìƒê°í•˜ë©´ ê°€ìž¥ ì´í•´ê°€ ì‰½ë‹¤

ê°™ì€ ë””ìžì¸ì„ cleaní•˜ê²Œ ë§Œë“¤ë ¤ë©´:

âœ” Non-Pipelined Multi-Cycle êµ¬ì¡°(ê¶Œìž¥)
cycle 1: PC -> instr_reg
cycle 2: instr_reg -> opcode/operand_reg
cycle 3: R0, operand_reg -> ALU -> alu_result_reg
cycle 4: R0 <- alu_result_reg
cycle 5: UART <- alu_result_reg


ê° ë ˆì§€ìŠ¤í„°ê°€ pipeline stage ì—­í• 

ë°ì´í„° ê²½ë¡œ ê¹¨ë—

UART íƒ€ì´ë° ëª…í™•

manualê³¼ cpu ëª¨ë“œ ë¶„ë¦¬ê°€ ì‰¬ì›€
(ëª¨ë“œë¥¼ ë°”ê¾¸ë©´ ì‚¬ìš©ë˜ëŠ” ë‹¨ê³„ë§Œ ë‹¬ë¼ì§)

ðŸ‘‘ ê²°ë¡ 

ì§€ê¸ˆ ì„¤ê³„ ë¬¸ì œëŠ” ëŒ€ë¶€ë¶„ â€œíŒŒì´í”„ë¼ì¸ì´ ì—†ëŠ”ë° íŒŒì´í”„ë¼ì¸ì²˜ëŸ¼ ë’¤ì„žì¸ êµ¬ì¡°â€ ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ê²ƒ.

ðŸ‘‰ ê·¸ëž˜ì„œ *â€œíŒŒì´í”„ë¼ì´ë‹ ìœ ë¬´ì˜ ì°¨ì´ë¥¼ ì´í•´í•˜ê³ , í•œ ë‹¨ê³„ì”© ë™ìž‘ì‹œí‚¤ëŠ” Multi-Cycle êµ¬ì¡°ë¥¼ ë§Œë“œëŠ” ê²ƒâ€*ì´ ì „ì²´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” í•µì‹¬ ë°©í–¥ì´ ë¨.
